# EASAY-RSA Basics

## Installation

```shell
sudo apt install easy-rsa
```

## Usage

### Create a CA

> NOTE:
>
> Newer version of easy-rsa requires setting password for CA key.

```shell
mkdir mypki-ca
cd mypki-ca
cp -rp /usr/share/easy-rsa/* ./
./easy-rsa init-pki
mv openssl-easyrsa.cnf pki/
./easy-rsa build-ca # this will create ca.crt in ./pki/ and key in ./pki/private/
```

### Create a server cert signing request

> NOTE:
>
> Newer version of easy-rsa requires setting password for key.

```shell
mkdir mypki-server
cd mypki-server
cp -rp /usr/share/easy-rsa/* ./
./easy-rsa init-pki
mv openssl-easyrsa.cnf pki/
./easy-rsa gen-req myserver # this will create request in ./pki/reqs and key in ./pki/private/
```

### Sign the server cert (switch back to pki-ca dir and do the following steps)

```shell
cd ../pki-ca
# Older version of easy-rsa
./easy-rsa import-req myserver ../pki-server/pki/reqs/myserver.req
./easy-rsa sign-req myserver # this will create the signed server cert in ./pki/issued/

# Newer version of easy-rsq
./easy-rsa import-req ../pki-server/pki/reqs/myserver.req myserver
./easy-rsa sign-req server myserver # this will create the signed server cert in ./pki/issued/
```

At this point, we have four files:

- CA certificate
- CA key
- self-signed server certificate
- server key

## What's next?

> NOTE:
>
> Server key file generated by newer version of easy-rsa is protected by a pass-phrase, so decrypt it first.
>
> openssl rsa -in KEY-FILE -out KEY-FILE.decrypted

Now, we can configure server programs (nginx, httpd, openvpn) to use the server certificate and server key. Optionally, we can install the CA certificate on server OS and client OS.
